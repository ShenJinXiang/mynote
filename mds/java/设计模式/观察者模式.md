# 观察者模式

## 定义
定义对象之间的一种一对多的依赖关系，使得每当一个对象状态发生改变时，其相关依赖对象都得到通知并被自动更新

## 角色信息
* 目标（Subject）：目标又称为主题，它是指被观察的对象。在目标中定义了一个观察者集合，一个观察目标可以接受任意数量的观察者来观察，它提供一系列方法来增加和删除观察者对象，同时它定义了通知方法notify()。目标类可以是接口，也可以是抽象类或具体类
* 具体目标（ConcreteSubject）：具体目标是目标类的子类，通常它包含有经常发生改变的数据，当它的状态发生改变时，向它的各个观察者发出通知；同时它还实现了在目标类中定义的抽象业务逻辑方法（如果有的话）。如果无须扩展目标类，则具体目标类可以省略
* 观察者（Observer）：观察者将对观察目标的改变做出反应，观察者一般定义为接口，该接口声明了更新数据的方法update()，因此又称为抽象观察者
* 具体观察者（ConcreteObserver）：在具体观察者中维护一个指向具体目标对象的引用，它存储具体观察者的有关状态，这些状态需要和具体目标的状态保持一致；它实现了在抽象观察者Observer中定义的update()方法。通常在实现时，可以调用具体目标类的attach()方法将自己添加到目标类的集合中或通过detach()方法将自己从目标类的集合中删除

## 代码实现
观察者：
```java
public interface Observer {

    void update();
}
```

具体观察者：
```java
public class ConcreteObserver implements Observer {

    private String name;

    public ConcreteObserver(String name) {
        this.name = name;
    }

    @Override
    public void update() {
        System.out.println(this.name + " 收到通知");
    }
}
```

目标类：
```java
public interface Subject {

    void attach(Observer observer);

    void detach(Observer observer);

    void doNotify();
}
```
具体目标类：
```java
public class ConcreteSubject implements Subject {

    private List<Observer> observerList = new ArrayList<Observer>();

    @Override
    public void attach(Observer observer) {
        observerList.add(observer);
    }

    @Override
    public void detach(Observer observer) {
        observerList.remove(observer);
    }

    @Override
    public void doNotify() {
        for(Observer observer : observerList) {
            observer.update();
        }
        System.out.println("共有" + this.observerList.size() + "名观察者接收到通知!");
    }
}
```

客户端测试代码：
```java
public class Client {

    public static void main(String[] args) {
        Subject subject = new ConcreteSubject();

        Observer observer1 = new ConcreteObserver("观察者1");
        Observer observer2 = new ConcreteObserver("观察者2");
        Observer observer3 = new ConcreteObserver("观察者3");
        Observer observer4 = new ConcreteObserver("观察者4");

        subject.attach(observer1);
        subject.attach(observer2);
        subject.attach(observer3);
        subject.attach(observer4);
        subject.doNotify();

        System.out.println("移除观察者3以后");
        subject.detach(observer3);
        subject.doNotify();
    }
}
```

*运行结果：*
```
观察者1 收到通知
观察者2 收到通知
观察者3 收到通知
观察者4 收到通知
共有4名观察者接收到通知!
移除观察者3以后
观察者1 收到通知
观察者2 收到通知
观察者4 收到通知
共有3名观察者接收到通知!
```


