# HTTP报文
如果说HTTP是互联网的心事，那么HTTP报文就是用来搬东西的包裹了

## 报文流
HTTP报文是在HTTP应用程序之间发送的数据块。这些数据块以一些文本形式的元信息(meta-infomation)开头，这些信息描述了报文的内容及含义，后面跟着可选的数据部分，这些报文在客户端、服务器和代理之间流动

### 报文流入源端服务器
HTTP使用术语*流入*(inbound)和*流出*(outbound)来描述*事物处理*(transaction)的方向。报文流入源端服务器，工作完成后，会流回用户的Agent代理中

### 报文向下游流动
HTTP报文会像流水一样流动，不管是请求报文还是响应报文，所有报文都会像下游流动，所有报文的发送者都在接收者的上游

## 报文的组成部分
HTTP报文由三部分组成：对报文进行描述的*起始行*(start line)、包含属性的*首部*(header)块，以及可选的、包含数据的*主体*(body)部分

起始行和首部就是由行分割的ASCII文本。每行都以一个由两个字符组成的行终止序列作为结束，其中包括一个回车符(ASCII码13)和换行符(ASCII码10)

报文的主体是一个可选的数据库，与起始行和首部不同的是，主体中可以包含文本或二进制数据，也可以为空

### 报文的语法
所有的HTTP报文都可以分为两类：*请求报文*(request message)和*响应报文*(response message)。请求报文会向Web服务器请求一个动作。响应报文会将请求的结果返回给客户端。请求和响应报文的基本结构相同

*请求报文的格式：*
> &lt;method&gt; &lt;request-URL&gt; &lt;version&gt;    
> &lt;headers&gt;
>
> &lt;entity-body&gt;

*响应报文的格式：*
> &lt;version&gt; &lt;status&gt; &lt;reason-phrase&gt;    
> &lt;headers&gt;
>
> &lt;entity-body&gt;

**说明**

*方法(method)*

客户端希望服务器对资源执行的动作，一个单独的词，比如 GET、HEAD或POST

*请求URL(request-URL)*

命名了锁请求的资源，或者url路径组件的完整url

*版本(version)*

报文所使用的HTTP版本，格式：

> HTTP/&lt;major&gt;.&lt;minor&gt;

其中*主要版本号*(major)和*次要版本号*(minor)都是整数

*原因短语(reason-phrase)*

数据状态码的可读板块，包括行终止序列之前的所有文本

*首部(header)*

可以有零个或多个首部，每个首部都包含一个名字，后面跟着一个冒号(:)，然后是一个可选的空格，接着是一个值，最后是一个CRLF。首部是由一个空行结束的，表示了首部列表的结束和实体主体部分的开始

*实体的主体部分(entity-body)*

实体的主体部分包含一个任意数据组成的数据库，并不是所有的报文都包含实体的主体部分

### 起始行
所有的HTTP报文都以一个起始行作为开始

**请求行**

包含了一个方法和一个请求URL，还包含了HTTP版本

**响应行**

响应报文承载了状态信息和操作产生的所有结果数据，将其返回给客户端。包含了响应报文使用的HTTP版本、数字状态码以及描述操作状态的文本形式的原因短语

**方法**

请求的起始行以方法作为开始，用来告知服务器要做些什么

*常用HTTP方法*

|方法|描述|是否包含主体|
|:--|:--|:--:|
|GET|从服务器获取一份文档|否|
|HEAD|只从服务器获取文档的首部|否|
|POST|向服务器发送需要处理的数据|是|
|PUT|将请求的主体部分存储在服务器上|是|
|TRACE|将可能经过代理服务器传送到服务器上去的报文进行追踪|否|
|OPTIONS|决定可以在服务器上执行哪些方法|否|
|DELETE|从服务器上删除一份文档|否|

**状态码**

方法是告诉服务器做什么事情的，状态码则用来告诉客户端，发生了什么事情，状态码位于响应的起始行中

*状态码分类*

|整体范围|已定义范围|分类|
|:--:|:--:|:--|
|100 ~ 199|100 ~ 101|信息提示|
|200 ~ 299|200 ~ 206|成功|
|300 ~ 399|300 ~ 305|重定向|
|400 ~ 499|400 ~ 415|客户端错误|
|500 ~ 599|500 ~ 505|服务器错误|

*常见状态码*

|状态码|原因短语|含义|
|200|OK|成功。请求的所有数据都在响应主体中|
|401|Unauthorized(未授权)|需要输入用户名和密码|
|404|Not Found(未找到)|服务器无法找到所请求URL对应的资源|

**原因短语**

原因短语是响应起始行中的最后一个组件，对章台吗提供了文本形式的解释。 原因短语和状态码是成对出现的，原因短语是状态码的可读版本

**版本号**

版本号会以HTTP/x.y 的形式出现在请求和响应报文的起始行中

### 首部
HTTP首部字段向请求和响应报文中添加了一些附加信息，是一些 名/值 对的列表

**首部分类**

HTTP规范定义了几种首部字段，应用程序也可以随意发明自己所用的首部

|分类名称|描述|
|:--|:--|
|通用首部|既可以出现在请求报文中，也可以出现在响应报文中|
|请求首部|提供更多有关请求的信息|
|响应首部|提供更多有关响应的信息|
|实体首部|描述主体的长度和内容，或者资源自身|
|扩展首部|规范中没有定义的新首部|

每个HTTP首部都有一种简单的语法：名字后面跟着冒号(:)，然后跟上可选的空格，再跟上字段值，最后一个是CRLF

*常见的首部实例*

|首部实例|描述|
|Date: Tue,30ct 1997 02:16:03 GMT|服务器产生响应的日期|
|Content-length:15040|实体的主体部分包含了15040字节的数据|
|Content-type:image/gif|实体的主体部分是一个GIF图片|
|Accept: image/gif, image/jpeg, text/html|客户端可以接收GIF图片和JPEG图片以及HTML|

**首部延续行**

将长的首部行分为多行可以提高可读性，多出来的每行前面至少要有一个空格或制表符(tab)

*例如:*
```
HTTP/1.0 200 OK
Content-Type: image/gif
Content-Length: 8572
Server: Test Server
	Version 1.0
```

在这个例子中，响应报文里包含了一个Server首部，值被划分成了多个延续行，首部的完整值为 ```Test Server Version 1.0```

### 实体的主体部分
HTTP报文的第三部分是可选的实体主体的部分。实体的主体是HTTP报文的负荷，就是HTTP要传输的内容

HTTP报文可以承载很多类型的数字数据：图片、视频、HTML文档、软件应用程序、信用卡事务、电子邮件等

## 方法

### GET
GET方法是最常用的方法。通常用于请求服务器发送某个资源。HTTP/1.1要求服务器实现此方法

### HEAD
HEAD方法与GET方法的行为很类似，但服务器在响应中只返回首部。不会返回实体的主体部分。运行客户端在为获取实际资源的情况下，对资源的首部进行检查

* 在不获取资源的情况下了解资源的情况(比如，判断其类型)
* 通常查看响应的状态码，查看某个对象是否存在
* 通过查看首部，测试资源是否被修改了

服务器开发者必须确保返回的首部与GET请求所返回的首部完全相同。

### PUT
与GET方法从服务器读取文档相反，PUT方法会向服务器写入文档。因为PUT运行用户对内容进行修改，所以很多Web服务器都要求在执行PUT方法之前，用密码登录

### POST
POST方法起初是用来向服务器输入数据的，通常会用来支持HTML表单，表单中的数据会被发送给服务器

### TRACE
客户端发起一个请求时，这个请求可能要穿过防火墙、代理、网关或其他一些应用程序，每个中间节点都可能会修改原始的HTTP请求，TRACE方法允许客户端在最终请求发给服务器时，查看请求报文

TRACE请求会在目的的服务器端发起一个“环回”诊断，行程最后一站的服务器会弹出一条TRACE响应，并在响应主体中携带收到的原始请求报文。这样客户端就可以查看所有中间HTTP应用程序组成的请求/响应链上，原始报文是否、如何被毁坏或修改

TRACE方法主要用于诊断，也就是说，用于验证请求是否如愿穿过了请求/响应链

### OPTIONS
OPTIONS方法请求Web服务器告知其支持的各种功能。可以询问服务器通常支持哪些方法，或者可以对某些特殊资源支持哪些方法

### DELETE
DELETE方法请求服务器删除请求URL所指定的资源，但是客户端应用程序无法保证删除操作一定会被执行。因为HTTP规范运行服务器在不通知客户端的情况下撤销请求

## 状态码

### 100 ~ 199 -- 信息性状态码
HTTP/1.1 向协议中引入了信息性状态码

*信息性状态码及原因短语*

|状态码|原因短语|含义|
|:--:|:--|:--|
|100|Continue|说明收到了请求的初始部分，请客户端继续，发送了这个状态码之后，服务器在收到请求之后必须进行响应|
|101|Switching Protocols|说明服务器正在根据客户端的指定，将协议切换成Update首部所列的协议|

### 200 ~ 299 -- 成功状态码
客户端发起请求是，这些请求通常都是成功的，服务器有一组用来表示成都状态码，分别对应不同类型的请求

*成功状态码和原因短语*

|状态码|原因短语|含义|
|:--:|:--|:--|
|200|OK|请求没有问题，实体的主体部分包含了所请求的资源|
|201|Created|用于创建服务器对象的请求(比如，PUT)。响应的实体主体部分中应该包含各种引用了已创建的资源的URL|
|202|Accepted|请求已被接受，但服务器还未对其执行任何动作不能保证服务器会完成这个请求|
|203|Non-Authoritative Information|实体首部包含的信息不是来自于源端服务器，而是来自资源的一份副本|
|204|No Content|响应报文中包含若干首部和一个状态行，但没有实体的主体部分，主要用于在浏览器不转为显示新文档的情况下，对其进行更新|
|205|Reset Content|另一个主要用于浏览器的代码，负责告知浏览器清楚当前页面中的所有HTML表单元素|
|206|Partial Content|成功执行了一个部分或Range(范围)请求|

### 300 ~ 399 -- 重定向状态码
重定向状态码要么告知客户端使用替代位置来访问他们所感兴趣的资源，要么就提供一个替代的响应而不是资源的内容

*重定向状态码与原因短语*

|状态吗|原因短语|含义|
|:--:|:--|:--|
|300|Multiple Choices|客户端请求一个实际指向多个资源的URL时，返回这个状态码|
|301|Moved Permanently|在请求的URL已被移除时使用，响应的location首部中应该包含资源现在所处的URL|
|302|Found|与301类似，但是客户端应该使用location首部给出的url来临时定位资源，将来的请求仍应使用老的url|
|303|See Other|告知客户端应该用另一个URL来获取资源，新的URL位于响应报文的location首部，主要目的是允许post请求的响应将客户端定向到某个资源上去|
|304|Not Modified|客户端可以通过包含的请求首部，使其请求变成有条件的|
|305|Use Proxy|用来说明必须通过一个代理来访问资源；代理的位置由location首部给出，很重要的一点是，客户端是相对于某个特定资源来解析这条响应的，不能假定所有请求资源的服务器的请求都通过这个代理进行，如果客户端错误的让代理介入了某条请求，可能会引发破坏性行为，而且会造成安全漏洞|
|306|(未使用)|当前未使用|
|307|Temporary Redirect|与304类似，但客户端应该用location首部给出的URL来临时定位资源，将来的请求应该使用老的url|

当HTTP／1.0客户端发起一个POST请求，并在响应中收到302重定向状态码时，会接受location首部的重定向url，并向那个url发起get请求(而不是post请求)

### 400 ~ 499 -- 客户端错误状态码

*客户端错误状态码及原因短语*

|状态码|原因短语|含义|
|:--:|:--|:--|
|400|Bad Request|用于告知客户端它发送了一个错误的请求|
|401|Unauthorized|与适当的首部一同返回，在这些首部中国年请求客户端在获取对资源的访问权之前，对自己进行认证|
|402|Payment Required|尚未使用，保留|
|403|Forbidden|说明请求被服务器拒绝了|
|404|Not Found|用于说明服务器无法找到锁清秋的url，通常会包含一个实体，以便客户端应用程序显示给用户看|
|405|Method Not Allowed|发起的请求中带有所请求的url不支持的方法时，使用此状态码，应该在响应中包含Allow首部，以告知客户端对所请求的资源可以使用哪些方法|
|406|Not Acceptable|客户端可以指定参数来说明他们愿意接受说明类型的实体，服务器没有雨客户端可接受的URL相匹配的资源时，使用此代码|
|407|Proxy Authentication Required|与401状态码类似，但用于要求对资源进行认证的代理服务器|
|408|Request Timeout|如果客户端完成请求说话的事件太长，服务器可以会送此状态码，并关闭连接|
|409|Conflict|用于说明请求可能在资源上引发的一些冲突，服务器担心请求会引发冲突时，可以发送此状态码，响应中应该包含描述冲突的主体|
|410|Gone|与404类似，只是服务器曾经拥有过此资源，主要用于Web站点的维护|
|411|Length Required|服务器要求在请求报文中包含Content-length首部时使用|
|412|Precondition Failed|客户端发起了条件请求，且其中一个条件失败了的时候使用，客户端包含了Expect首部时发起的就是条件请求|
|413|Request Entity Too Large|客户端发送的实体主体部分比服务器能够或者希望处理的要大时，使用此状态码|
|414|Request URL Too Long|客户端所发请求中的请求URL比服务器能够或者希望处理的要长时，使用此状态码|
|415|Unsupported Media Type|服务器无法理解或无法支持客户端所发实体的内容类型时|
|416|Requested Range Not Satisfiable|请求报文所请求的时指定资源的某个范围，而此范围无效或无法满足时，使用此状态码|
|417|Expectaion Failed|请求的Expect首部包含一个期望，但是服务器无法满足此期望时，使用此状态码|

### 500 ~ 599 -- 服务器错误状态码
有时客户端发送了一条有效请求，服务器自身却出错了。

*服务器错误状态码及原因短语*

|状态码|原因短语|含义|
|:--:|:--|:--|
|500|Internal Server Error|服务器遇到一个妨碍它为请求提供服务的错误时|
|501|Not Implemented|客户端发起的请求超出服务器的能力范围时|
|502|Bad gateway|作为代理或者网关使用的服务器从请求响应链的下一条链上收到的一条伪响应时，使用此状态码|
|503|Service Unavailable|用来说明服务器现在无法为请求提供服务，但将来可以|
|504|Gateway Timeout|与408类似，至少这里的响应来自一个网关或者代理，它们在等待另一个服务器时，对其请求进行响应超时了|
|505|HTTP Version Not Supported|服务器收到的请求使用了它无法或者不愿支持的协议版本是，使用此状态码|

## 首部
首部和方法配合，共同决定了客户端和服务器能够做什么事情

* 通用首部 - 客户端和服务器都可以使用的首部
* 请求首部 - 请求报文特有，为服务器提供了一些额外的信息
* 响应首部 - 响应报文特有，为客户端提供信息
* 实体首部 - 用于应对实体主体部分的首部
* 扩展首部 - 非标准的首部，由应用程序开发者创建，还未添加到已批准的http规范中去

### 通用首部

*通用信息性首部:*

|首部|描述|
|:--|:--|
|Connection|允许客户端和服务器指定与请求／响应连接有关的选项|
|Date|提供日期和时间标志，说明报文是什么时间创建的|
|MIME-Version|给出了发送端使用的MIME版本|
|Trailer|如果报文采用了分块传输编码(chunked transfer encoding)方式，可以使用这个首部列出报文拖挂部分的首部集合|
|Transfer-Encoding|告知接收端，为了保证报文的可靠传输，对报文采用了什么编码方式|
|Update|给处了发送端可能想要升级使用的新版本或协议|
|Via|显示报文经过的中间点(代理、网关)|

*通用缓存首部:*

|首部|描述|
|:--|:--|
|Cache-Control|用于随报文传送缓存提示|
|Pragma|另一种随报文传送指示的方式，但并不专用于缓存|

### 请求首部

*请求的信息性首部:*

|首部|描述|
|:--|:--|
|Client-IP|提供了运行客户端的机器的IP地址|
|From|提供了客户端用户的email地址|
|Host|接收请求的服务器的主机名和端口号|
|Referer|提供了包含当前请求URL文档的URL|
|UA-Color|提供了与客户端显示器的显示颜色有关的信息|
|UA-CPU|客户端的CPU的类型或制造商|
|UA-Disp|提供了与客户端显示器能力有关的信息|
|UA-os|运行在客户端机器上的操作系统名称及版本|
|UA-Pixels|客户端显示器的像素信息|
|User-Agent|将发起请求的应用程序的名称告知服务器|

**Accept首部**

Accept告知服务器客户端的喜好和能力

*Accept首部:*

|首部|描述|
|:--|:--|
|Accept|告知服务器能够发送哪些媒体类型|
|Accept-Charset|告诉服务器能够发送哪些字符集|
|Accept-Encoding|告诉服务器能够发送哪些编码方式|
|Accept-Language|告诉服务器能够发送哪些语言|
|TE|告诉服务器可以使用哪些扩展传输编码|

**条件请求首部**

|首部|描述|
|:--|:--|
|Expect|允许客户端列出某请求所要求的服务器行为|
|If-Match|如果实体标记与文档当前的实体标记相匹配，就获取这份文档|
|If-Modified-Since|除非某个指定的日期后资源被修改所，否则就限制这个请求|
|If-None-Match|如果提供实体标记与当前文档的实体标记不相符，就获取文档|
|If-Range|运行对文档的某个范围进行条件请求|
|If-Unmodified-Since|除非在某个指定日期之后资源没有被修改过，否则就限制这个请求|
|Range|如果服务器支持范围请求，就请求资源的请求范围|

**安全请求首部**

|首部|描述|
|:--|:--|
|Authorization|包含了客户端提供给服务器，以便对其自身进行认证的数据|
|Cookie|客户端用它向服务器传送一个令牌|
|Cookie2|用来说明请求端支持的cookie版本|

**代理请求首部**

|首部|描述|
|:--|:--|
|Max-Forward|在通往源端服务器的路径上，将请求转发给其他代理或网关的最大次数|
|Proxy-Authorization|与Authorization首部相同，但这个首部是在与代理进行认证时使用的|
|Proxy-Connection|与Connection首部相同，但是用在代理建立连接使用的|

### 响应首部
响应首部为客户端提供了一些额外信息，比如谁在发送响应，响应者的功能等等

*响应的信息性首部:*

|首部|描述|
|:--|:--|
|Age|响应持续时间|
|Public|服务器为其资源支持的请求方法列表|
|Retry-After|如果资源不可用的画，在此日期或时间重试|
|Server|服务器应用程序软件的名称和版本|
|Title|对HTML文档来说，就是html文档的源端给出的标题|
|Warning|比原因短语中更详细一些的警告报文|

**协商首部**

|首部|描述|
|:--|:--|
|Accept-Ranges|对此资源来说，服务器可接收的范围类型|
|Vary|服务器查看其它首部的列表，可能会使响应发生变化，就是说，这个一个首部列表|

**安全响应首部:**

|首部|描述|
|:--|:--|
|Proxy-Authenticate|来自代理的对客户端的质询列表|
|Set-Cookie|不是真正的安全首部，但隐含有安全功能，可以在客户端设置一个令牌，以便服务器对客户端进行标识|
|Set-Cookie2|与Set-Cookie类似，RFC2965 Cookie定义|
|www-Authenticate|来自服务器对对客户端的质询列表|

### 实体首部
请求和响应报文中都可能会出现实体首部

*实体的信息性首部*

|首部|描述|
|:--|:--|
|Allow|列出了可以对此实体执行的请求方法|
|Location|告知客户端实体实际上位于何处，用于将接收端定向到资源的位置上去|

*内容首部*

|首部|描述|
|:--|:--|
|Content-Base|解析主体中的相对URL时使用的基础url|
|Content-Encoding|对主体执行的任意编码方式|
|Content-Language|理解主体时最适宜使用的自然语言|
|Content-Length|主体的长度或尺寸|
|Content-Location|资源实际所处的位置|
|Content-MD5|主体的MD5校验|
|Content-Range|在整个资源中此实体表示的字节范围|
|Content-Type|这个主体的对象类型|

*实体缓存首部*

|首部|描述|
|:--|:--|
|ETag|与此实体相关的实体标记|
|Expires|实体不再有效，要从原始的源端再次获取此实体的日期和时间|
|Last-Modified|这个实体最后一次被修改的日期和时间|
